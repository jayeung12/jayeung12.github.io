---
title: "Analyzing ViReMa Output in R"
author: "Jason Yeung"
date: "12/25/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

------

## **Getting Started with ViReMa in R**

This tutorial will guide users through analyzing viral recombination data from [ViReMa](https://bioconda.github.io/recipes/virema/README.html) in R. For more details on using R, see <http://rmarkdown.rstudio.com>.


If you are completely new to R, download the latest version of RStudio before following along.

<br>
  
## **Setting Up**
The first step will be to install and load packages:
```{r loading,eval=FALSE}
install.packages(c("ggplot2","tidyverse","circlize"))
library(ggplot2)
library(tidyverse)
library(circlize)
```
  
  
This allows us to use popular functions we'll need for data visualization.
  
  
Now, let's **load some example data** I've provided:

```{r import, eval=F}

#We've provided some sample data for the purposes of this tutorial
#Load provided example data

data = ""
  
```

Alternatively, load in your own data and follow along with the rest of the tutorial. Naturally, the plots will not be exactly the same as the ones we show.

```{r import1,eval=FALSE}
#Or you can use your own data
#Load own data from local directory

#This loads in a single file
#skip excludes the first line of the file
data = read.table("--replace with the file path--.bed",skip=1, sep="\t",stringsAsFactors=FALSE, quote="")

#To load in multiple files all in the same directory, we can use the following:

filenames <- list.files("--replace with the directory--", pattern="*.bed", full.names=TRUE)
filelist = list()
for(i in 1:length(filenames)){
  filelist[[i]] =   read.table(filenames[i],skip=1, sep="\t",stringsAsFactors=FALSE, quote="")
}

#Combines all of the files, row by row
data = do.call(rbind, filelist)

```
  
<br>
The data is in .BED6 format but the file extension may just say .BED or .TXT. If that's the case, you will need to match the file extension in the above code to load in your own data. 

**Included in your files need to have at least 6 columns** - these correspond to .  
![optional caption text](files/img.png)

<br>

## **Plotting Recombination Events**

### **Scatterplot**
Now that we have the data loaded in, let's make our first plot. We will use 'ggplot2' to make a scatterplot with acceptor and donor sites on the axes.

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

<br>

### **Coverage Plot**
This plot serves as a coverage plot. It takes each recombination event and adds the number of reads at nucleotide indexes between the donor and acceptor site. Depending on if deletion or duplication events are being plotted, this shows areas of the genome which are either frequently removed or included in recombination events.
<br>

### **Circos Plot**
This plot is a Circos plot made using the 'circlize' package. It allows for recombination events to be visualized alongside annotations or other quantitative data.


**There are multiple places to find annotations for your viral genome.** 
NCBI has annotations associated with sequences. Below shows the process for a popular SARS-CoV-2 reference sequence.
![Accessing the annotations at UCSC](files/exportNCBIanno.gif)

<br>
The UCSC Genome browser website has a comprehensive collection of annotations for SARS-CoV-2. Access the "Data Integrator" at <https://genome.ucsc.edu/cgi-bin/hgIntegrator>. Below shows the process of exporting data:

![Accessing the annotations at UCSC](files/exportUCSCanno.gif)
<br><br>
Then, copy the data into Notepad or another text editor and save it as a .BED or .TXT file.

<br>

### **Nucelotide Usage Plot**
This plot shows the frequency of nucleotides proximal and distal to recombination sites. In order to generate these plots, you had to select the option to produce this output when performing the analysis with ViReMA. The necessary columns look like this:
<br>


## **Segmented Viruses**

Plotting events in segmented viruses requires some changes to the code we used above. .BED files will contain multiple reference sequence IDs in the first column corresponding to the different segments of the viral genome.

We can also make the Circos plot with multiple reference sequences.
